<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <button onclick="buttonPress()">Get Current Position</button>
    <br />
    <br />
    <select id="posSelect" name="posSelectOptn" form="positionForm">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
    <form id="positionForm" onsubmit="formSubmit(event)">
      <input type="submit" value="Send Position to Server" />
    </form>
    <p id="pos"></p>
    <p id="nextPos"></p>
    <script>
      let pos;
      let nexPos;
      let finished = false;

      window.addEventListener("load", function () {
        setInterval(fetchPosition, 1000);
      });

      function fetchPosition() {
        fetch("http://54.78.246.30:8081/api/position/e6295a5e", {
          method: "GET",
          // headers: {
          //   "Content-Type": "application/x-www-form-urlencoded",
          //   "Content-Length": "10",
          // },
        })
          .then(async (data) => data.text())
          .then((res) => {
            pos = res;
            document.getElementById("pos").innerHTML =
              "Current Position = " + pos;
          });
      }

      // Get info from server
      function buttonPress() {
        fetch("http://54.78.246.30:8081/api/position/e6295a5e", {
          method: "GET",
          // headers: {
          //   "Content-Type": "application/x-www-form-urlencoded",
          //   "Content-Length": "10",
          // },
        })
          .then((data) => data.text())
          .then((res) => {
            pos = res;
            document.getElementById("pos").innerHTML =
              "Current Position = " + pos;
          });
      }

      function formSubmit(e) {
        e.preventDefault();
        let posToSend = e.target[0].value;
        if (posToSend >= 0 && posToSend <= 5) {
          fetch("http://54.78.246.30:8081/api/arrived/e6295a5e", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
              "Content-Length": "10",
            },
            body: "position=" + posToSend,
          })
            .then(async (data) => {
              d = await data.text();
              if (d == "undefined") {
                finished = true;
              } else {
                return d;
              }
            })
            .then((res) => {
              nextPos = res;
              document.getElementById("nextPos").innerHTML =
                "Next Position = " + nextPos;
            });
          // Also update current position
          fetch("http://54.78.246.30:8081/api/position/e6295a5e", {
            method: "GET",
            // headers: {
            //   "Content-Type": "application/x-www-form-urlencoded",
            //   "Content-Length": "10",
            // },
          })
            .then(async (data) => data.text())
            .then((res) => {
              pos = res;
              document.getElementById("pos").innerHTML =
                "Current Position = " + pos;
            });
        }
      }
    </script>
  </body>
</html>
